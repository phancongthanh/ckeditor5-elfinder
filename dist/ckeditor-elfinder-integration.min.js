window.integrateWithElFinder=function(e){const t=e.commands.get("ckfinder"),o=e.plugins.get("FileRepository"),n=e.plugins.get("Notification"),i=e.locale.t;let r;const a=t=>new Promise(((o,a)=>{if(!r){let o=document.createElement("div");document.body.appendChild(o),r=$(o).dialogelfinder({modal:!0,title:"File Manager",url:window.connectorUrl||"/el-finder/file-system/connector",startPathHash:t||void 0,useBrowserHistory:!1,autoOpen:!1,width:"80%",commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},getFileCallback:(t,o)=>{let r=[];var a;o.getUI("cwd").trigger("unselectall"),t.forEach((t=>{let n=o.convAbsUrl(t.url);t&&t.mime.match(/^image\//i)?r.push(n):e.execute("link",n)})),r.length&&(a=r,e.commands.get("imageUpload").isEnabled?e.execute("imageInsert",{source:a}):n.showWarning(i("Could not insert image at the current position."),{title:i("Inserting image failed"),namespace:"ckfinder"}))}}).elfinder("instance")}t?Object.keys(r.files()).length?new Promise(((e,o)=>{r.file(t)?e():r.request({cmd:"parents",target:t}).done((n=>{r.file(t)?e():o()})).fail((()=>{o()}))})).then((()=>{r.exec("open",t).done((()=>{o(r)})).fail((e=>{a(r,e||"errFolderNotFound")}))})).catch((e=>{a(r,e||"errFolderNotFound")})):r.one("open",(()=>{r.file(t)?o(r):a(r,"errFolderNotFound")})):o(r)}));t&&(t.execute=()=>{a().then((e=>{e.getUI().dialogelfinder("open")}))}),e.on("destroy",(()=>{r&&r.getUI().dialogelfinder("close")}));const l=function(e){this.upload=async function(){let t=e.file;(t instanceof Promise||t&&"function"==typeof t.then)&&(t=await t),await async function(e){try{const t=await a(window.uploadTargetHash),o=t.getUI();o.dialogelfinder("open"),await new Promise((e=>setTimeout(e,1e3)));const n=window.uploadTargetHash||t.cwd().hash,i=await t.exec("upload",{files:[e],target:n},void 0,n);if(!i.added||!i.added.length)throw o.dialogelfinder("close"),new Error(t.i18n(i.error?i.error:"errUpload"));try{const e=await t.url(i.added[0].hash,{async:!0});return o.dialogelfinder("close"),{default:t.convAbsUrl(e)}}catch(e){throw o.dialogelfinder("close"),new Error("errFileNotFound")}}catch(e){throw console.log(e),new Error("errUploadNoFiles")}}(t)},this.abort=function(){r&&r.getUI().trigger("uploadabort")}};o.createUploadAdapter=e=>new l(e)};